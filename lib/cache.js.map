{"version":3,"sources":["../src/cache.js"],"names":["cachePath","_buildCache","_cacheChanged","_filelistCache","setParams","v","_params","getParams","setExt","_ext","getExt","getSrc","_src","setSrc","getDist","_dist","setDist","setPages","_pages","getPages","getConfig","_config","setConfig","setFileList","key","getFileList","getBuildCache","file","isFile","readFile","JSON","parse","e","setBuildCache","cache","getModifiedTime","clearBuildCache","unlink","saveBuildCache","writeFile","stringify","checkBuildCache"],"mappings":";;;;;;AAAA;;;;;;AAEA,IAAMA,YAAY,YAAlB;AACA,IAAIC,cAAc,IAAlB;AACA,IAAIC,gBAAgB,KAApB;AACA,IAAIC,iBAAiB,EAArB;;kBAEe;AACXC,aADW,qBACAC,CADA,EACG;AACV,aAAKC,OAAL,GAAeD,CAAf;AACH,KAHU;AAIXE,aAJW,uBAIE;AACT,eAAO,KAAKD,OAAZ;AACH,KANU;AAOXE,UAPW,kBAOHH,CAPG,EAOA;AACP,aAAKI,IAAL,GAAYJ,CAAZ;AACH,KATU;AAUXK,UAVW,oBAUD;AACN,eAAO,KAAKD,IAAL,IAAa,MAApB;AACH,KAZU;AAaXE,UAbW,oBAaD;AACN,eAAO,KAAKC,IAAL,IAAa,KAApB;AACH,KAfU;AAgBXC,UAhBW,oBAgBQ;AAAA,YAAXR,CAAW,uEAAP,KAAO;;AACf,aAAKO,IAAL,GAAYP,CAAZ;AACH,KAlBU;AAmBXS,WAnBW,qBAmBA;AACP,eAAO,KAAKC,KAAL,IAAc,MAArB;AACH,KArBU;AAsBXC,WAtBW,qBAsBU;AAAA,YAAZX,CAAY,uEAAR,MAAQ;;AACjB,aAAKU,KAAL,GAAaV,CAAb;AACH,KAxBU;AAyBXY,YAzBW,sBAyBO;AAAA,YAARZ,CAAQ,uEAAJ,EAAI;;AACd,aAAKa,MAAL,GAAcb,CAAd;AACH,KA3BU;AA4BXc,YA5BW,sBA4BC;AACR,eAAO,KAAKD,MAAL,IAAe,EAAtB;AACH,KA9BU;AA+BXE,aA/BW,uBA+BE;AACT,eAAO,KAAKC,OAAL,IAAgB,IAAvB;AACH,KAjCU;AAkCXC,aAlCW,uBAkCU;AAAA,YAAVjB,CAAU,uEAAN,IAAM;;AACjB,aAAKgB,OAAL,GAAehB,CAAf;AACH,KApCU;AAqCXkB,eArCW,uBAqCEC,GArCF,EAqCOnB,CArCP,EAqCU;AACjBF,uBAAeqB,GAAf,IAAsBnB,CAAtB;AACH,KAvCU;AAwCXoB,eAxCW,uBAwCED,GAxCF,EAwCO;AACd,eAAOrB,eAAeqB,GAAf,KAAuB,IAA9B;AACH,KA1CU;AA2CXE,iBA3CW,yBA2CIC,IA3CJ,EA2CU;AACjB,YAAI1B,WAAJ,EACI,OAAOA,WAAP;;AAEJ,YAAI,eAAK2B,MAAL,CAAY5B,SAAZ,CAAJ,EAA4B;AACxBC,0BAAc,eAAK4B,QAAL,CAAc7B,SAAd,CAAd;AACA,gBAAI;AACAC,8BAAc6B,KAAKC,KAAL,CAAW9B,WAAX,CAAd;AACH,aAFD,CAEE,OAAO+B,CAAP,EAAU;AACR/B,8BAAc,IAAd;AACH;AACJ;;AAED,eAAOA,eAAe,EAAtB;AACH,KAzDU;AA0DXgC,iBA1DW,yBA0DIN,IA1DJ,EA0DU;AACjB,YAAIO,QAAQ,KAAKR,aAAL,EAAZ;AACAQ,cAAMP,IAAN,IAAc,eAAKQ,eAAL,CAAqBR,IAArB,CAAd;AACA1B,sBAAciC,KAAd;AACAhC,wBAAgB,IAAhB;AACH,KA/DU;AAgEXkC,mBAhEW,6BAgEO;AACd,uBAAKC,MAAL,CAAYrC,SAAZ;AACH,KAlEU;AAmEXsC,kBAnEW,4BAmEM;AACb,YAAIpC,aAAJ,EAAmB;AACf,2BAAKqC,SAAL,CAAevC,SAAf,EAA0B8B,KAAKU,SAAL,CAAevC,WAAf,CAA1B;AACAC,4BAAgB,KAAhB;AACH;AACJ,KAxEU;AAyEXuC,mBAzEW,2BAyEKd,IAzEL,EAyEW;AAClB,YAAIO,QAAQ,KAAKR,aAAL,EAAZ;AACA,eAAOQ,MAAMP,IAAN,KAAeO,MAAMP,IAAN,MAAgB,eAAKQ,eAAL,CAAqBR,IAArB,CAAtC;AACH;AA5EU,C","file":"cache.js","sourcesContent":["import util from './util';\n\nconst cachePath = '.wepycache';\nlet _buildCache = null;\nlet _cacheChanged = false;\nlet _filelistCache = {};\n\nexport default {\n    setParams (v) {\n        this._params = v;\n    },\n    getParams () {\n        return this._params;\n    },\n    setExt (v) {\n        this._ext = v;\n    },\n    getExt () {\n        return this._ext || '.wpy';\n    },\n    getSrc () {\n        return this._src || 'src';\n    },\n    setSrc (v = 'src') {\n        this._src = v;\n    },\n    getDist () {\n        return this._dist || 'dist';\n    },\n    setDist (v = 'dist') {\n        this._dist = v;\n    },\n    setPages (v = []) {\n        this._pages = v;\n    },\n    getPages () {\n        return this._pages || [];\n    },\n    getConfig () {\n        return this._config || null;\n    },\n    setConfig (v = null) {\n        this._config = v;\n    },\n    setFileList (key, v) {\n        _filelistCache[key] = v;\n    },\n    getFileList (key) {\n        return _filelistCache[key] || null;\n    },\n    getBuildCache (file) {\n        if (_buildCache)\n            return _buildCache;\n\n        if (util.isFile(cachePath)) {\n            _buildCache = util.readFile(cachePath);\n            try {\n                _buildCache = JSON.parse(_buildCache);\n            } catch (e) {\n                _buildCache = null;\n            }\n        }\n\n        return _buildCache || {};\n    },\n    setBuildCache (file) {\n        let cache = this.getBuildCache();\n        cache[file] = util.getModifiedTime(file);\n        _buildCache = cache;\n        _cacheChanged = true;\n    },\n    clearBuildCache() {\n        util.unlink(cachePath);\n    },\n    saveBuildCache() {\n        if (_cacheChanged) {\n            util.writeFile(cachePath, JSON.stringify(_buildCache));\n            _cacheChanged = false;\n        }\n    },\n    checkBuildCache(file) {\n        let cache = this.getBuildCache();\n        return cache[file] && cache[file] === util.getModifiedTime(file);\n    }\n}"]}